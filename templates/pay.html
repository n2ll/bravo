<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>결제하기</title>
  <script src="https://democpay.payple.kr/js/v1/payment.js"></script>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: #FFF5F1; /* 기본 배경 */
      color: #3A001E;      /* 메인 텍스트 */
      margin: 0;
      padding: 20px;
    }

    h2 {
      color: #3A001E; /* 헤드라인 */
    }

    .price-box {
      background: #FFFFFF;
      border: 1px solid #E0E0E0;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin: 8px 0;
    }

    p {
      font-weight: bold;
    }

    #final {
      color: #FB493D; /* 금액 강조 */
    }

    button {
      display: block;
      width: 100%;
      background: #FB493D; /* CTA 버튼 */
      color: #FFF5F1;
      border: none;
      border-radius: 30px;
      padding: 15px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
    }

    button:hover {
      background: #BB8378; /* Hover 시 보조 배경 */
      color: #FFF5F1;
    }
  </style>
</head>
<body>
  <h2>토커 예약하기</h2>

  <div class="price-box">
    <label><input type="radio" name="duration" value="15" data-price="9900" checked> 15분 (9,900원)</label>
    <label><input type="radio" name="duration" value="30" data-price="19800"> 30분 (19,800원)</label>
    <label><input type="radio" name="duration" value="45" data-price="29700"> 45분 (29,700원)</label>
    <label><input type="radio" name="duration" value="60" data-price="39600"> 60분 (39,600원)</label>
  </div>

  <p>최종 금액: <span id="final">9,900</span>원</p>
  <button onclick="pay()">지금 결제하기</button>

  <script>
    // 금액 업데이트 함수
    function updatePrice() {
      const selected = document.querySelector('input[name="duration"]:checked');
      const price = selected.dataset.price;
      document.getElementById("final").innerText = Number(price).toLocaleString();
    }

    // 라디오 버튼 클릭할 때마다 updatePrice 실행
    document.querySelectorAll('input[name="duration"]').forEach(radio => {
      radio.addEventListener('change', updatePrice);
    });

    // 초기 실행 (기본값 세팅)
    window.onload = updatePrice;
  </script>
  <!-- jQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <!-- Payple SDK -->
  <script src="https://democpay.payple.kr/js/v1/payment.js"></script>
  <script>
    function pay() {
      let obj = {
        clientKey: "test_DF55F29DA654A8CBC0F0A9DD4B556486",
        PCD_CST_ID: "test",
        PCD_CUST_KEY: "abcd1234567890",
        PCD_PAY_TYPE: "card",
        PCD_PAY_WORK: "CERT",
        PCD_CARD_VER: "02",
        PCD_PAY_GOODS: "테스트 상품",
        PCD_PAY_TOTAL: 1000,
        PCD_RST_URL: "http://localhost:5000/pay/result"
      };

      console.log("[pay] 호출 파라미터:", obj);

      if (typeof PaypleCpayAuthCheck !== "function") {
        alert("⚠️ Payple SDK가 아직 준비되지 않았습니다.");
        return;
      }

      PaypleCpayAuthCheck(obj, function(result) {
        console.log("[PaypleCpayAuthCheck 콜백]", result);
        if (result.PCD_PAY_RST === "success") {
          alert("결제 인증 성공! 요청키: " + result.PCD_PAY_REQKEY);
        } else {
          alert("결제 실패: " + result.PCD_PAY_MSG);
        }
      });
    }
  </script>
</body>
</html>
