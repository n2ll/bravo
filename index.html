<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>Bravo Push</title>
</head>
<body>
  <button onclick="initPush()">ğŸ”” ì•Œë¦¼ ê¶Œí•œ í—ˆìš©</button>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-messaging.js"></script>

  <script>
    // âœ… Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSy8nVWvhYv9xSpuTsFwCT191HB31Tu1Ko_",
      authDomain: "bravo-2954e.firebaseapp.com",
      projectId: "bravo-2954e",
      storageBucket: "bravo-2954e.appspot.com",
      messagingSenderId: "527906393561",
      appId: "1:527906393561:web:60206163b82b7898cb13a0"
    };

    firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging();

    // âœ… í‘¸ì‹œ ì´ˆê¸°í™” í•¨ìˆ˜
    async function initPush() {
      try {
        // âš ï¸ GitHub PagesëŠ” /bravo/ í•˜ìœ„ ê²½ë¡œì´ë¯€ë¡œ ì„œë¹„ìŠ¤ì›Œì»¤ ê²½ë¡œ ìˆ˜ì •
        const reg = await navigator.serviceWorker.register('/bravo/firebase-messaging-sw.js');
        messaging.useServiceWorker(reg);

        const perm = await Notification.requestPermission();
        if (perm !== 'granted') {
          alert('ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.');
          return;
        }

        // âœ… VAPID í‚¤ë¡œ í† í° ë°œê¸‰
        const token = await messaging.getToken({
          vapidKey: 'BIA5dEeeCB2YaSWtzlrubUXEk74jfJL08WCcj6zSiLHkJJvArmkpp4XOvCzMttUHXtRnPi-5LtqIqoEMlhJ93G8'
        });

        console.log("âœ… ë°œê¸‰ëœ FCM í† í°:", token);
        // iframe í†µì‹ ìš© (ì„ íƒì‚¬í•­)
        parent.postMessage({ type: 'FCM_TOKEN', token }, '*');
      } catch (err) {
        console.error('âŒ FCM ì´ˆê¸°í™” ì˜¤ë¥˜:', err);
      }
    }
  </script>
</body>
</html>
