<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>Bravo Push</title>
</head>
<body>
  <button onclick="initPush()">🔔 알림 권한 허용</button>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-messaging.js"></script>

  <script>
    // ✅ Firebase 설정
    const firebaseConfig = {
      apiKey: "AIzaSy8nVWvhYv9xSpuTsFwCT191HB31Tu1Ko_",
      authDomain: "bravo-2954e.firebaseapp.com",
      projectId: "bravo-2954e",
      storageBucket: "bravo-2954e.appspot.com",
      messagingSenderId: "527906393561",
      appId: "1:527906393561:web:60206163b82b7898cb13a0"
    };

    firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging();

    // ✅ 푸시 초기화 함수
    async function initPush() {
      try {
        // ⚠️ GitHub Pages는 /bravo/ 하위 경로이므로 서비스워커 경로 수정
        const reg = await navigator.serviceWorker.register('/bravo/firebase-messaging-sw.js');
        messaging.useServiceWorker(reg);

        const perm = await Notification.requestPermission();
        if (perm !== 'granted') {
          alert('알림 권한이 거부되었습니다.');
          return;
        }

        // ✅ VAPID 키로 토큰 발급
        const token = await messaging.getToken({
          vapidKey: 'BIA5dEeeCB2YaSWtzlrubUXEk74jfJL08WCcj6zSiLHkJJvArmkpp4XOvCzMttUHXtRnPi-5LtqIqoEMlhJ93G8'
        });

        console.log("✅ 발급된 FCM 토큰:", token);
        // iframe 통신용 (선택사항)
        parent.postMessage({ type: 'FCM_TOKEN', token }, '*');
      } catch (err) {
        console.error('❌ FCM 초기화 오류:', err);
      }
    }
  </script>
</body>
</html>
