<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>Bravo Push (Debug)</title>
</head>
<body>
  <h2>Bravo Push (Debug Version)</h2>
  <button onclick="initPush()">ğŸ”” ì•Œë¦¼ ê¶Œí•œ í—ˆìš©</button>

  <!-- âœ… Firebase compat ë²„ì „ -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-messaging-compat.js"></script>

  <script>
    console.log("ğŸš€ [ì‹œì‘] í˜ì´ì§€ ë¡œë“œë¨");

    // âœ… Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSy8nVWvhYv9xSpuTsFwCT191HB31Tu1Ko_",
      authDomain: "bravo-2954e.firebaseapp.com",
      projectId: "bravo-2954e",
      storageBucket: "bravo-2954e.appspot.com",
      messagingSenderId: "527906393561",
      appId: "1:527906393561:web:60206163b82b7898cb13a0"
    };

    console.log("âš™ï¸ Firebase ì´ˆê¸°í™” ì‹œì‘");
    firebase.initializeApp(firebaseConfig);
    console.log("âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ");

    const messaging = firebase.messaging();

    async function initPush() {
      console.log("â–¶ï¸ [initPush] ì‹¤í–‰ë¨");
      try {
        // âœ… GitHub Pages í™˜ê²½ì—ì„œëŠ” í•˜ìœ„ í´ë”(bravo) ëª…ì‹œ
        console.log("ğŸ§© ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ ì‹œë„ ì¤‘...");
        const reg = await navigator.serviceWorker.register('/bravo/firebase-messaging-sw.js');
        console.log("âœ… ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ ì™„ë£Œ:", reg);

        messaging.useServiceWorker(reg);
        console.log("ğŸ“¦ messaging.useServiceWorker ì—°ê²° ì™„ë£Œ");

        // âœ… ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
        console.log("ğŸ”” ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ ì¤‘...");
        const perm = await Notification.requestPermission();
        console.log("ğŸ”” ê¶Œí•œ ìƒíƒœ:", perm);

        if (perm !== 'granted') {
          console.warn("âš ï¸ ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë¨");
          alert('ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.');
          return;
        }

        // âœ… FCM í† í° ë°œê¸‰ ì‹œë„
        console.log("ğŸª„ FCM í† í° ìš”ì²­ ì¤‘...");
        const token = await messaging.getToken({
          vapidKey: 'BIA5dEeeCB2YaSWtzlrubUXEk74jfJL08WCcj6zSiLHkJJvArmkpp4XOvCzMttUHXtRnPi-5LtqIqoEMlhJ93G8'
        });

        if (token) {
          console.log("âœ… ë°œê¸‰ëœ FCM í† í°:", token);
          parent.postMessage({ type: 'FCM_TOKEN', token }, '*');
        } else {
          console.warn("âš ï¸ í† í°ì„ ê°€ì ¸ì˜¤ì§€ ëª»í•¨ (null/undefined)");
        }

      } catch (err) {
        console.error("âŒ [initPush] ì—ëŸ¬ ë°œìƒ:", err);
      }
    }

    // âœ… ì„œë¹„ìŠ¤ì›Œì»¤ ì§€ì› ì—¬ë¶€ ë¡œê·¸
    if ('serviceWorker' in navigator) {
      console.log("ğŸ§© ë¸Œë¼ìš°ì €ê°€ Service Workerë¥¼ ì§€ì›í•©ë‹ˆë‹¤.");
    } else {
      console.error("âŒ Service Workerë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
    }

    // âœ… Notification API ì§€ì› ì—¬ë¶€ ë¡œê·¸
    if ('Notification' in window) {
      console.log("ğŸ”” Notification API ì§€ì› í™•ì¸ë¨");
    } else {
      console.error("âŒ Notification APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    }
  </script>
</body>
</html>
